<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blog Admin — Willonski Lab</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fff;--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--brand:#466d7c;--card:#f8fafc}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink);line-height:1.6}
    .wrap{max-width:1080px;margin:0 auto;padding:24px}
    h1,h2{font-family:"Playfair Display",serif;margin:.2rem 0}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    fieldset{border:1px solid var(--line);border-radius:12px;background:var(--card)}
    legend{padding:0 8px}
    label{display:block;font-weight:600;margin:.6rem 0 .2rem}
    input,select,textarea{width:100%;padding:.6rem .7rem;border:1px solid var(--line);border-radius:8px;font:inherit}
    textarea{min-height:88px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{display:inline-block;border:1px solid var(--brand);border-radius:10px;padding:.65rem 1rem;background:linear-gradient(180deg,#466d7c22,transparent);font-weight:700;color:#0f172a;margin-top:10px;cursor:pointer}
    .btn.secondary{background:transparent}
    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:900px){.cards{grid-template-columns:1fr 1fr}}
    @media (max-width:620px){.cards{grid-template-columns:1fr}}
    .post{background:#f8fafc;border:1px solid var(--line);border-radius:14px;overflow:hidden}
    .media{background:#000}
    .ar-9x16{aspect-ratio:9/16}.ar-1x1{aspect-ratio:1/1}.ar-16x9{aspect-ratio:16/9}
    .post-body{padding:12px}
    .post-title{font-family:"Playfair Display",serif;font-size:1.05rem;margin:.2rem 0}
    .tiny{color:var(--muted);font-size:.9rem}
    pre{white-space:pre-wrap;background:#0f172a;color:#e2e8f0;padding:12px;border-radius:10px;max-height:300px;overflow:auto}
    .sticky{position:sticky;top:16px;align-self:start}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Blog Admin</h1>
    <p class="tiny">Wypełnij formularz → dodaj do listy → skopiuj JSON i wklej do <code>/content/blog.json</code> w GitHub.</p>

    <div class="grid">
      <!-- Form -->
      <form id="f" class="">
        <fieldset>
          <legend>Nowy wpis</legend>

          <label for="type">Typ</label>
          <select id="type" required>
            <option value="reel">Reel (9:16)</option>
            <option value="square">Square (1:1)</option>
            <option value="research">Research (full)</option>
          </select>

          <div class="row">
            <div>
              <label for="title">Tytuł</label>
              <input id="title" required />
            </div>
            <div>
              <label for="date">Data (YYYY-MM-DD)</label>
              <input id="date" placeholder="2025-10-29" required />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="tag">Tag (np. Reel / Post 1:1 / Research)</label>
              <input id="tag" />
            </div>
            <div>
              <label for="url">URL (PDF / strona / zewn.)</label>
              <input id="url" placeholder="/pdfs/leaflet.pdf or https://..." />
            </div>
          </div>

          <label for="cover">Okładka (ścieżka do obrazu)</label>
          <input id="cover" placeholder="/media/.../image.jpg" />

          <div id="videoRow" style="display:none">
            <label for="video">Wideo (MP4, tylko dla Reel)</label>
            <input id="video" placeholder="/media/reels/name.mp4" />
          </div>

          <label for="excerpt">Zajawka (krótkie streszczenie)</label>
          <textarea id="excerpt"></textarea>

          <label for="aria">ARIA label (opcjonalnie)</label>
          <input id="aria" placeholder="Dostępny opis linku" />

          <button type="submit" class="btn">Dodaj do listy</button>
          <button type="button" id="reset" class="btn secondary">Wyczyść formularz</button>
        </fieldset>
      </form>

      <!-- JSON + Actions -->
      <div class="sticky">
        <h2>JSON</h2>
        <pre id="json">[]</pre>
        <button id="copy" class="btn">Kopiuj JSON</button>
        <button id="download" class="btn secondary">Pobierz blog.json</button>
      </div>
    </div>

    <h2>Podgląd kart</h2>
    <div id="preview" class="cards"></div>
  </div>

  <script>
    const f = document.getElementById('f');
    const videoRow = document.getElementById('videoRow');
    const out = document.getElementById('json');
    const preview = document.getElementById('preview');
    const state = [];

    const fmt = (d)=>{ try{return new Date(d).toLocaleDateString('pl-PL')}catch{return d||''} };
    const esc = (s)=> String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

    document.getElementById('type').addEventListener('change', (e)=>{
      videoRow.style.display = e.target.value === 'reel' ? '' : 'none';
    });

    f.addEventListener('submit', (e)=>{
      e.preventDefault();
      const get = id => document.getElementById(id).value.trim();
      const item = {
        type: get('type'),
        title: get('title'),
        date: get('date'),
        tag: get('tag') || undefined,
        excerpt: get('excerpt') || undefined,
        url: get('url'),
        cover: get('cover') || undefined,
        aria: get('aria') || undefined
      };
      if (item.type === 'reel') {
        const v = document.getElementById('video').value.trim();
        if (v) item.video = v;
      }
      // minimal validation
      if (!item.type || !item.title || !item.date || !item.url) {
        alert('Wymagane: typ, tytuł, data, URL.'); return;
      }

      state.push(item);
      // sort newest first
      state.sort((a,b)=>(b.date||'').localeCompare(a.date||''));
      out.textContent = JSON.stringify(state, null, 2);

      // render preview card
      preview.innerHTML = state.map(p => {
        if (p.type === 'reel') {
          const media = p.video
            ? `<div class="media ar-9x16"><video preload="metadata" poster="${esc(p.cover||'')}" muted playsinline><source src="${esc(p.video)}" type="video/mp4"></video></div>`
            : `<div class="media ar-9x16"><img src="${esc(p.cover||'')}" alt=""></div>`;
          return `<article class="post">${media}<div class="post-body"><div class="tiny">${esc(p.tag||'Reel')}</div><div class="post-title">${esc(p.title)}</div><div class="tiny">${fmt(p.date)}</div></div></article>`;
        }
        if (p.type === 'square') {
          return `<article class="post"><div class="media ar-1x1"><img src="${esc(p.cover||'')}" alt=""></div><div class="post-body"><div class="tiny">${esc(p.tag||'Post 1:1')}</div><div class="post-title">${esc(p.title)}</div><div class="tiny">${fmt(p.date)}</div></div></article>`;
        }
        return `<article class="post" style="grid-column:1/-1"><div class="media ar-16x9"><img src="${esc(p.cover||'')}" alt=""></div><div class="post-body"><div class="tiny">${esc(p.tag||'Research')}</div><div class="post-title">${esc(p.title)}</div><div class="tiny">${fmt(p.date)}</div></div></article>`;
      }).join('');

      f.reset();
      videoRow.style.display = 'none';
      document.getElementById('type').value = 'reel';
    });

    document.getElementById('reset').addEventListener('click', ()=> f.reset());

    document.getElementById('copy').addEventListener('click', async ()=>{
      await navigator.clipboard.writeText(out.textContent);
      alert('Skopiowano JSON. Wklej do /content/blog.json w GitHub.');
    });

    document.getElementById('download').addEventListener('click', ()=>{
      const blob = new Blob([out.textContent], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'blog.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });
  </script>
</body>
</html>